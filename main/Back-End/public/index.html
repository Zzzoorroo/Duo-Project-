<!DOCTYPE html>
<html>

<head>
    <title>Socket.IO Chat</title>
</head>

<body>
    <h1>Socket.IO Test</h1>
    <h2 id="status">Connecting...</h2>

    <ul id="messages"></ul>
    <input id="messageInput" placeholder="Type a message..." />
    <button id="sendBtn">Send</button>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <script>
        const socket = io('http://localhost:3000');

        const messagesList = document.getElementById("messages");
        const status = document.getElementById("status");
        const input = document.getElementById("messageInput");
        const sendBtn = document.getElementById("sendBtn");

        let username = "";
        let email = "";

        socket.on("connect", () => {
            status.innerText = "Connected!";
            username = prompt("Enter your username:") || "Anonymous";
            email = prompt("Enter your email:") || "No email";
            socket.emit("registerUser", { username, email });
        });

        // when user joins
        socket.on("userJoined", (data) => {
            const li = document.createElement("li");
            li.style.color = "green";
            li.textContent = `${data.username} joined the chat!`;
            messagesList.appendChild(li);
        });

        // when user leaves (optional)
        socket.on("userLeft", (data) => {
            const li = document.createElement("li");
            li.style.color = "red";
            li.textContent = `${data.username} left the chat.`;
            messagesList.appendChild(li);
        });

        // load chat history
        socket.on("chatHistory", (msgs) => {
            msgs.forEach((msg) => {
                const li = document.createElement("li");
                li.textContent = `${msg.username}: ${msg.text}`;
                messagesList.appendChild(li);
            });
        });

        // listen for messages
        socket.on("message", (data) => {
            const li = document.createElement("li");
            li.textContent = data;
            messagesList.appendChild(li);
        });

        // send message
        sendBtn.onclick = () => {
            const text = input.value.trim();
            if (!text) return;
            socket.emit("message", text);
            input.value = "";
        };
    </script>
</body>

</html>